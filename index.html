<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI & Metaverse Innovation Center - Ultimate Reader</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-gradient: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%);
            --accent-neon: #00f3ff;
            --accent-laser: #ff0055;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background: var(--bg-gradient);
            height: 100vh; margin: 0; overflow: hidden;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- 1. Background Particles --- */
        #bg-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
        }

        /* --- UI Elements --- */
        .top-bar {
            width: 100%; padding: 10px 30px;
            background: rgba(255,255,255,0.03); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.05);
            height: 80px;
        }

        .logo-container { display: flex; align-items: center; gap: 15px; }
        .logo-text { display: flex; flex-direction: column; justify-content: center; }
        .logo-main {
            color: var(--accent-neon); font-weight: 800; font-size: 1.2rem; 
            letter-spacing: 0.5px; text-transform: uppercase; 
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5); line-height: 1.1;
        }
        .logo-sub {
            color: #ddd; font-size: 0.8rem; font-weight: 300; 
            margin-top: 3px; opacity: 0.9;
        }
        
        .action-group { display: flex; gap: 10px; }

        .btn-glass {
            background: rgba(255,255,255,0.1); color: white; padding: 8px 20px; 
            border-radius: 50px; cursor: pointer; font-weight: 600; transition: 0.3s; 
            border: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 8px;
        }
        .btn-glass:hover { background: rgba(255,255,255,0.2); box-shadow: 0 0 15px rgba(255,255,255,0.2); }
        .btn-active { background: var(--accent-neon); color: black; border-color: var(--accent-neon); box-shadow: 0 0 15px var(--accent-neon); }
        
        .upload-btn {
            background: linear-gradient(90deg, #00d2ff 0%, #3a7bd5 100%);
            border: none; box-shadow: 0 0 15px rgba(0, 210, 255, 0.3);
        }
        #file-input { display: none; }

        /* --- Stage & Book --- */
        .stage {
            flex-grow: 1; width: 100%; position: relative;
            display: flex; justify-content: center; align-items: center;
            perspective: 2500px; overflow: hidden;
        }

        .book {
            position: relative; height: 75vh; width: auto;
            display: flex; transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 30px 70px rgba(0,0,0,0.8);
        }
        .book.zoomed { transform: scale(1.8); cursor: grab; }
        .book.single-mode .page-slot.left { display: none; }
        .book.single-mode .page-slot.right { border-radius: 5px; border-left: none; }

        .page-slot {
            flex: 1; background-color: #fafafa; position: relative; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }
        .page-slot.left { border-radius: 5px 0 0 5px; background: linear-gradient(to right, #ccc, #fff 10%); }
        .page-slot.right { border-radius: 0 5px 5px 0; background: linear-gradient(to left, #ccc, #fff 10%); }
        .page-slot canvas { width: 100%; height: 100%; object-fit: fill; }
        
        /* Animations */
        .anim-swipe-next { animation: swipeNext 0.5s ease-out; }
        .anim-swipe-prev { animation: swipePrev 0.5s ease-out; }
        @keyframes swipeNext { 0% { transform: rotateY(0deg); } 50% { transform: rotateY(-20deg) translateX(-50px); } 100% { transform: rotateY(0deg); } }
        @keyframes swipePrev { 0% { transform: rotateY(0deg); } 50% { transform: rotateY(20deg) translateX(50px); } 100% { transform: rotateY(0deg); } }

        /* --- Controls & Camera --- */
        .bottom-bar {
            background: rgba(0,0,0,0.8); padding: 10px 30px; border-radius: 40px; margin-bottom: 20px;
            display: flex; justify-content: center; gap: 15px; z-index: 100;
            border: 1px solid #333; backdrop-filter: blur(10px);
        }
        .nav-btn {
            background: transparent; color: #888; border: 1px solid #444; width: 45px; height: 45px; 
            border-radius: 50%; font-size: 1.2rem; cursor: pointer; transition: 0.3s;
        }
        .nav-btn:hover { color: #fff; border-color: #fff; transform: scale(1.1); }
        .nav-btn.active { color: var(--accent-neon); border-color: var(--accent-neon); box-shadow: 0 0 10px var(--accent-neon); }
        .page-info { color: #fff; font-family: monospace; padding: 0 15px; display: flex; align-items: center; font-size: 1.1rem; }

        .camera-box {
            position: absolute; bottom: 100px; right: 30px; width: 220px; height: 165px; 
            background: #000; border: 2px solid #333; border-radius: 12px; overflow: hidden; 
            transition: 0.3s; z-index: 200; box-shadow: 0 10px 40px rgba(0,0,0,0.7);
        }
        .camera-box.hidden { opacity: 0; pointer-events: none; }
        .cam-feed { width: 100%; height: 100%; transform: scaleX(-1); object-fit: cover; }

        /* --- 2. Advanced Cursor (Laser) --- */
        #cursor {
            position: fixed; width: 0; height: 0; pointer-events: none; z-index: 9999; 
            transform: translate(-50%, -50%); display: none;
            border: 2px solid var(--accent-neon); border-radius: 50%;
            transition: width 0.2s, height 0.2s, background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 0 20px var(--accent-neon);
        }
        #cursor.active { width: 40px; height: 40px; }
        
        /* Laser Mode Style */
        #cursor.laser {
            width: 15px; height: 15px;
            background-color: var(--accent-laser);
            border: none;
            box-shadow: 0 0 15px var(--accent-laser), 0 0 30px var(--accent-laser);
        }
        
        #status-msg {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85); color: white; padding: 25px 50px; border-radius: 20px;
            font-size: 2rem; pointer-events: none; opacity: 0; transition: 0.3s; z-index: 500;
            border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        #status-msg.show { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        #status-msg i { color: var(--accent-neon); font-size: 3rem; margin-bottom: 10px; }

        /* --- 3. Settings Panel --- */
        .settings-panel {
            position: absolute; top: 90px; right: 30px; width: 250px;
            background: rgba(0,0,0,0.9); border: 1px solid #333; border-radius: 15px;
            padding: 20px; z-index: 300; color: white; display: none;
        }
        .settings-panel.show { display: block; }
        .setting-item { margin-bottom: 15px; }
        .setting-label { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; color: #aaa; }
        input[type=range] { width: 100%; accent-color: var(--accent-neon); }

        .loader-text { color: #555; font-size: 1.2rem; }
        @media (max-width: 768px) {
            .logo-sub { display: none; }
            .logo-main { font-size: 1rem; }
            .camera-box { width: 120px; height: 90px; bottom: 80px; }
        }
		.logo-img {
            /* กำหนดขนาดให้ชัดเจน */
            width: 60px;
            height:60px;
            
            /* ทำเป็นวงกลม */
            border-radius: 50%;
            
            /* สำคัญมาก: บังคับให้รูปย่อส่วนลงมาให้พอดีกรอบวงกลม */
            object-fit: cover; 
            
            /* เส้นขอบและเงาเดิม */
            border: px solid var(--accent-neon);
            box-shadow: 0 0 0px rgba(0, 243, 255, 0.3);
        }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <div class="top-bar">
      <div class="logo-container">
            <img src="https://lh5.googleusercontent.com/d/1ooZHCA9cvXUFJGZCC5EjHqVsNtrw05up" alt="Profile Logo" class="logo-img">
            
            <div class="logo-text">
                <div class="logo-main">AI & Metaverse Innovation Center</div>
                <div class="logo-sub">ศูนย์นวัตกรรมปัญญาประดิษฐ์ โรงเรียนสาธิตเทศบาลวัดเพชรจริก</div>
            </div>
        </div>

        <div class="action-group">
            <button class="btn-glass" id="voice-btn" onclick="toggleVoice()"><i class="fa-solid fa-microphone-slash"></i> Voice Off</button>
            <button class="btn-glass" onclick="toggleSettings()"><i class="fa-solid fa-sliders"></i> Settings</button>
            <label for="file-input" class="btn-glass upload-btn"><i class="fa-solid fa-folder-open"></i> Open PDF</label>
            <input type="file" id="file-input" accept="application/pdf">
        </div>
    </div>

    <div class="settings-panel" id="settings-panel">
        <div class="setting-item">
            <div class="setting-label"><span>Motion Sensitivity</span> <span id="val-sens">0.4</span></div>
            <input type="range" min="0.1" max="1.0" step="0.1" value="0.4" oninput="updateSettings(this.value)">
        </div>
        <div class="setting-item" style="font-size: 0.8rem; color: #666;">
            <p><strong>Voice Commands:</strong><br> "Next" (ถัดไป), "Back" (ย้อนกลับ),<br> "Zoom" (ขยาย), "Reset" (คืนค่า)</p>
        </div>
    </div>

    <div id="status-msg"><i class="fa-solid fa-check"></i> <span>System Ready</span></div>

    <div class="stage" id="stage">
        <div class="book" id="book">
            <div class="page-slot left" id="slot-l"><div class="loader-text">Waiting for PDF...</div></div>
            <div class="page-slot right" id="slot-r"><div class="loader-text">AI Ready</div></div>
        </div>
    </div>

    <div id="cursor"></div>

    <div class="bottom-bar">
        <button class="nav-btn" onclick="toggleCam()"><i class="fa-solid fa-video"></i></button>
        <button class="nav-btn" onclick="prevPage()"><i class="fa-solid fa-chevron-left"></i></button>
        <div class="page-info" id="page-num">0 / 0</div>
        <button class="nav-btn" onclick="nextPage()"><i class="fa-solid fa-chevron-right"></i></button>
        <button class="nav-btn" id="btn-zoom" onclick="toggleZoom()"><i class="fa-solid fa-search"></i></button>
        <button class="nav-btn" onclick="toggleFull()"><i class="fa-solid fa-expand"></i></button>
    </div>

    <div class="camera-box" id="cam-box">
        <video id="video" class="cam-feed" autoplay muted></video>
        <canvas id="canvas" class="cam-feed" style="position:absolute; top:0; left:0;"></canvas>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        // --- 1. Interactive Background Particles ---
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        let particles = []; let mouseX = 0, mouseY = 0;
        function resizeBg() { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeBg); resizeBg();
        class Particle {
            constructor() {
                this.x = Math.random() * bgCanvas.width; this.y = Math.random() * bgCanvas.height;
                this.size = Math.random() * 2 + 0.5; this.speedX = Math.random() * 1 - 0.5; this.speedY = Math.random() * 1 - 0.5;
                this.color = `rgba(0, 243, 255, ${Math.random() * 0.3})`;
            }
            update() {
                this.x += this.speedX; this.y += this.speedY;
                if(this.size < 0.2) this.size = 0;
                const dx = mouseX - this.x; const dy = mouseY - this.y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if(dist < 100) { this.x -= dx/20; this.y -= dy/20; }
                if(this.x < 0 || this.x > bgCanvas.width) this.speedX *= -1;
                if(this.y < 0 || this.y > bgCanvas.height) this.speedY *= -1;
            }
            draw() { bgCtx.fillStyle = this.color; bgCtx.beginPath(); bgCtx.arc(this.x, this.y, this.size, 0, Math.PI*2); bgCtx.fill(); }
        }
        function initParticles() { for(let i=0; i<80; i++) particles.push(new Particle()); }
        function animateParticles() { bgCtx.clearRect(0,0,bgCanvas.width,bgCanvas.height); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animateParticles); }
        initParticles(); animateParticles();

        // --- 2. Voice Control System (Thai Supported) ---
        let recognition; let isVoiceOn = false;
        function initVoice() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) { alert("Browser ไม่รองรับระบบเสียง แนะนำ Chrome บน PC/Android ครับ"); return; }
            recognition = new SpeechRecognition();
            recognition.continuous = true; recognition.interimResults = false; 
            recognition.lang = 'th-TH'; // ตั้งค่าภาษาไทย

            recognition.onstart = () => { console.log("Mic On (Thai Mode)"); showStatus("รอคำสั่งเสียง...", "fa-ear-listen"); };
            recognition.onend = () => { if(isVoiceOn) recognition.start(); };
            recognition.onresult = (event) => {
                const command = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                console.log(`ได้ยิน: "${command}"`);
                if(command.includes('ถัดไป') || command.includes('หน้าต่อไป') || command.includes('next')) nextPage();
                else if(command.includes('ย้อน') || command.includes('กลับ') || command.includes('back')) prevPage();
                else if(command.includes('ขยาย') || command.includes('ซูม') || command.includes('ใหญ่')) { if(!isZoomed) toggleZoom(); }
                else if(command.includes('ออก') || command.includes('ปกติ') || command.includes('รีเซ็ต')) { if(isZoomed) toggleZoom(); }
                showStatus(`คำสั่ง: "${command}"`, "fa-microphone");
            };
            recognition.onerror = (event) => {
                if(event.error === 'not-allowed') { alert("กรุณากดอนุญาตไมค์ที่แถบ Address Bar"); isVoiceOn = false; document.getElementById('voice-btn').classList.remove('btn-active'); }
            };
        }
        function toggleVoice() {
            const btn = document.getElementById('voice-btn'); if(!recognition) initVoice(); if(!recognition) return;
            if(!isVoiceOn) { try { recognition.start(); isVoiceOn = true; btn.classList.add('btn-active'); btn.innerHTML = '<i class="fa-solid fa-microphone"></i> Voice On'; } catch(e){} } 
            else { recognition.stop(); isVoiceOn = false; btn.classList.remove('btn-active'); btn.innerHTML = '<i class="fa-solid fa-microphone-slash"></i> Voice Off'; showStatus("ปิดรับคำสั่งเสียง", "fa-microphone-slash"); }
        }

        // --- 3. Core Reader Logic ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type='sine'; o.frequency.setValueAtTime(500, audioCtx.currentTime); g.gain.setValueAtTime(0.1, audioCtx.currentTime); 
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+0.2); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.2);
        }
        const fileInput = document.getElementById('file-input'); const book = document.getElementById('book');
        const slotL = document.getElementById('slot-l'); const slotR = document.getElementById('slot-r');
        const pageNumDisplay = document.getElementById('page-num'); const cursor = document.getElementById('cursor');
        const statusMsg = document.getElementById('status-msg');
        let pdfDoc = null, totalPages = 0, currentSpread = 0, maxSpreadIndex = 0;
        let isBusy = false, isZoomed = false, lastX = 0, lastY = 0, lastTime = 0, moveThreshold = 0.4;
        // Fist Logic Vars
        let fistStartTime = 0; let isHoldingFist = false; const ZOOM_HOLD_TIME = 3000;

        function toggleSettings() { document.getElementById('settings-panel').classList.toggle('show'); }
        function updateSettings(val) { moveThreshold = parseFloat(val); document.getElementById('val-sens').innerText = val; }
        fileInput.addEventListener('change', async (e) => { if(!e.target.files[0]) return; const buf = await e.target.files[0].arrayBuffer(); loadPDF(buf); });
        async function loadPDF(data) {
            try { pdfDoc = await pdfjsLib.getDocument(data).promise; totalPages = pdfDoc.numPages; maxSpreadIndex = Math.floor(totalPages/2);
                const p = await pdfDoc.getPage(1); const v = p.getViewport({scale:1}); const r = v.width/v.height; book.dataset.s = r; book.dataset.d = r*2;
                currentSpread = 0; render(); showStatus("PDF Loaded", "fa-file-pdf");
            } catch(e){alert(e.message);}
        }
        async function render() {
            let pL, pR; if(currentSpread===0) { book.classList.add('single-mode'); book.style.aspectRatio = `${book.dataset.s}/1`; pL=-1; pR=1; pageNumDisplay.innerText="COVER"; } 
            else { book.classList.remove('single-mode'); book.style.aspectRatio = `${book.dataset.d}/1`; pL=currentSpread*2; pR=currentSpread*2+1; pageNumDisplay.innerText=`${pL}-${pR>totalPages?'':pR}/${totalPages}`; }
            const draw = async (n, slot) => { slot.innerHTML=''; if(n>0 && n<=totalPages) { const p = await pdfDoc.getPage(n); const v = p.getViewport({scale:2}); const c = document.createElement('canvas'); const cx = c.getContext('2d'); c.width=v.width; c.height=v.height; await p.render({canvasContext:cx, viewport:v}).promise; slot.appendChild(c); } };
            await Promise.all([ pL>0?draw(pL,slotL):slotL.innerHTML='', pR>0?draw(pR,slotR):slotR.innerHTML='' ]);
        }
        function toggleZoom() {
            isZoomed = !isZoomed; const btn = document.getElementById('btn-zoom');
            if(isZoomed) { book.classList.add('zoomed'); btn.classList.add('active'); showStatus("Zoom In (Fist Triggered)", "fa-search-plus"); } 
            else { book.classList.remove('zoomed'); book.style.transform=''; btn.classList.remove('active'); showStatus("Zoom Out", "fa-search-minus"); }
        }
        function panBook(x, y) { if(!isZoomed) return; const cx = window.innerWidth/2, cy = window.innerHeight/2; book.style.transform = `scale(1.8) translate(${(cx-x)*0.8}px, ${(cy-y)*0.8}px)`; }
        function changePage(dir) {
            if(isBusy) return; if(dir==='next' && currentSpread<maxSpreadIndex) { isBusy=true; playSound(); book.classList.add('anim-swipe-next'); setTimeout(()=>{currentSpread++; render();},250); setTimeout(()=>{book.classList.remove('anim-swipe-next'); isBusy=false;},500); } 
            else if(dir==='prev' && currentSpread>0) { isBusy=true; playSound(); book.classList.add('anim-swipe-prev'); setTimeout(()=>{currentSpread--; render();},250); setTimeout(()=>{book.classList.remove('anim-swipe-prev'); isBusy=false;},500); }
        }
        function showStatus(t, i) { statusMsg.innerHTML=`<i class="fa-solid ${i}"></i><span>${t}</span>`; statusMsg.classList.add('show'); setTimeout(()=>statusMsg.classList.remove('show'),1500); }
        window.nextPage = ()=>changePage('next'); window.prevPage = ()=>changePage('prev'); window.toggleCam = ()=>document.getElementById('cam-box').classList.toggle('hidden'); window.toggleFull = ()=>!document.fullscreenElement?document.documentElement.requestFullscreen():document.exitFullscreen();

        // --- 4. AI Hand Tracking & FIST Logic (RIGHT HAND ONLY) ---
        const video = document.getElementById('video'); const canvas = document.getElementById('canvas'); const ctx = canvas.getContext('2d');
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        // ปรับ maxNumHands เป็น 2 เผื่อไว้เช็คว่าเป็นมือไหน
        hands.setOptions({ maxNumHands: 2, modelComplexity: 1, minDetectionConfidence: 0.6, minTrackingConfidence: 0.6 });

        function checkFist(landmarks) {
            const wrist = landmarks[0]; const fingerTips = [8, 12, 16, 20]; const fingerPips = [6, 10, 14, 18]; let curledCount = 0;
            for(let i=0; i<fingerTips.length; i++) { const dTip = (landmarks[fingerTips[i]].x - wrist.x)**2 + (landmarks[fingerTips[i]].y - wrist.y)**2; const dPip = (landmarks[fingerPips[i]].x - wrist.x)**2 + (landmarks[fingerPips[i]].y - wrist.y)**2; if(dTip < dPip) curledCount++; }
            return curledCount >= 3;
        }

        hands.onResults((results) => {
            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            
            let rightHandFound = false;

            if (results.multiHandLandmarks && results.multiHandedness) {
                // วนลูปหามือขวา
                for (let i = 0; i < results.multiHandedness.length; i++) {
                    const label = results.multiHandedness[i].label;
                    // *** หัวใจสำคัญ: กล้องกลับด้าน 'Left' คือ มือขวาจริง ***
                    if (label === 'Left') {
                        rightHandFound = true;
                        const marks = results.multiHandLandmarks[i];
                        
                        // วาดเส้นเฉพาะมือขวา
                        drawConnectors(ctx, marks, HAND_CONNECTIONS, {color: '#00f3ff', lineWidth: 2});
                        drawLandmarks(ctx, marks, {color: '#ffffff', lineWidth: 1, radius: 3});

                        const idx = marks[8]; const rawX = 1 - idx.x; const rawY = idx.y; const x = rawX * window.innerWidth; const y = rawY * window.innerHeight;
                        mouseX = x; mouseY = y;

                        // --- FIST LOGIC ---
                        const isFist = checkFist(marks);
                        if (isFist) {
                            if (!isHoldingFist) { isHoldingFist = true; fistStartTime = Date.now(); } 
                            else {
                                const elapsed = Date.now() - fistStartTime; const progress = Math.min(elapsed / ZOOM_HOLD_TIME, 1);
                                cursor.style.display = 'block'; cursor.style.left = x+'px'; cursor.style.top = y+'px'; cursor.style.width = '50px'; cursor.style.height = '50px'; cursor.style.backgroundColor = 'transparent'; cursor.style.border = '4px solid #ff9900'; cursor.style.borderRadius = '50%'; cursor.style.borderTopColor = '#fff'; cursor.style.transform = `translate(-50%, -50%) rotate(${progress * 360}deg)`;
                                if (elapsed > ZOOM_HOLD_TIME) { toggleZoom(); fistStartTime = Date.now() + 1000; cursor.style.borderColor = '#ff0055'; cursor.style.backgroundColor = '#ff0055'; }
                            }
                        } else {
                            isHoldingFist = false; fistStartTime = 0;
                            cursor.style.transform = `translate(-50%, -50%) rotate(0deg)`; cursor.style.border = '2px solid var(--accent-neon)'; cursor.style.backgroundColor = 'white'; cursor.style.width = ''; cursor.style.height = '';
                            
                            // --- SWIPE LOGIC ---
                            const now = Date.now(); const dt = (now - lastTime)/1000; const dx = rawX - lastX; const speed = Math.sqrt(dx*dx + (rawY-lastY)*(rawY-lastY))/dt;
                            cursor.style.display = 'block'; cursor.style.left = x+'px'; cursor.style.top = y+'px';
                            if (speed > moveThreshold && !isZoomed && !isBusy) { cursor.classList.add('active'); if (dx > 0.05) changePage('next'); else if (dx < -0.05) changePage('prev'); } 
                            else { cursor.classList.remove('active'); }
                            if (isZoomed) panBook(x, y); lastX = rawX; lastY = rawY; lastTime = now;
                        }
                        // เจอมือขวาแล้ว ทำงานเสร็จแล้ว เบรคเลย ไม่ต้องสนมืออื่น
                        break; 
                    }
                }
            }
            
            // ถ้าไม่เจอมือขวาเลย ให้ซ่อน Cursor และ Reset สถานะ
            if (!rightHandFound) {
                cursor.style.display = 'none';
                isHoldingFist = false;
            }
        });

        const cam = new Camera(video, { onFrame: async () => { await hands.send({image: video}); }, width: 320, height: 240 });
        cam.start();
    </script>
</body>
</html>
